<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ø±ÙÙŠÙ‚ Ø±Ù…Ø¶Ø§Ù†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@300;400;500;600;700&family=Reem+Kufi:wght@500;700&family=Alexandria:wght@300;400;500;700&family=Montserrat:wght@400;600&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <!-- Runs before paint: zero flash for returning users -->
    <script>
        (function() {
            const theme = localStorage.getItem('ramadanUserTheme');
            if (theme) {
                document.documentElement.setAttribute('data-theme', theme);
                const style = document.createElement('style');
                style.textContent = 'body{background-color:' + (theme === 'female' ? '#241245' : '#000000') + '!important}';
                document.head.appendChild(style);
            }
        })();
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    screens: { 'xs': '375px' },
                    colors: {
                        ramadan: { base: '#000000', surface: '#09090b', card: '#18181b', gold: '#fbbf24', teal: '#2dd4bf', rose: '#fb7185', accent: '#27272a' },
                        theme: { bg: '#241245', surface: '#3b1f63', primary: '#d8b4fe', accent: '#f0abfc', gold: '#fcd34d', success: '#4ade80' }
                    },
                    fontFamily: {
                        sans: ['IBM Plex Sans Arabic', 'sans-serif'],
                        alexandria: ['Alexandria', 'sans-serif'],
                        kufi: ['Reem Kufi', 'sans-serif'],
                        amiri: ['Amiri', 'serif'],
                        eng: ['Montserrat', 'sans-serif'],
                    },
                    animation: {
                        'swing-1': 'swing 3s ease-in-out infinite alternate',
                        'swing-2': 'swing 4.5s ease-in-out infinite alternate',
                        'swing-3': 'swing 5.5s ease-in-out infinite alternate',
                        'swing-4': 'swing 6s ease-in-out infinite alternate',
                        'float': 'float 6s ease-in-out infinite',
                        'twinkle': 'twinkle 3s ease-in-out infinite',
                        'fade-in': 'fadeIn 0.8s ease-out forwards',
                        'slide-up': 'slideUp 0.6s ease-out forwards',
                        'pulse-soft': 'pulseSoft 2s ease-in-out infinite',
                    },
                    keyframes: {
                        swing: { '0%': { transform: 'rotate(-5deg)' }, '100%': { transform: 'rotate(5deg)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        twinkle: { '0%, 100%': { opacity: '1' }, '50%': { opacity: '0.5' } },
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(16px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(24px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } },
                        pulseSoft: { '0%, 100%': { opacity: '0.6' }, '50%': { opacity: '1' } }
                    }
                }
            }
        }
    </script>

    <style>
        *, *::before, *::after { box-sizing: border-box; }
        body { -webkit-tap-highlight-color: transparent; transition: background-color 0.5s ease; overscroll-behavior: none; }
        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { border-radius: 10px; }
        
        /* â”€â”€ MALE THEME â”€â”€ */
        body.theme-male { background-color: #000; font-family: 'IBM Plex Sans Arabic', sans-serif; }
        body.theme-male ::-webkit-scrollbar-thumb { background: #3f3f46; }
        .theme-male .glass-panel {
            background: rgba(12,12,14,0.88); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px);
            border: 1px solid rgba(255,255,255,0.07); box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        .theme-male .active-prayer { background:#fff; color:#000; font-weight:700; box-shadow:0 0 16px rgba(255,255,255,0.25); border-color:transparent; }
        .theme-male .active-sunnah { color:#fbbf24; border-color:#fbbf24; background:rgba(251,191,36,0.08); }
        .theme-male .lantern-string { width:1.5px; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0.4) 40%, rgba(251,191,36,0.8)); margin:0 auto; }
        .theme-male .text-gradient-white { background: linear-gradient(to bottom, #ffffff, #94a3b8); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

        /* â”€â”€ FEMALE THEME â”€â”€ */
        body.theme-female { background-color: #241245; font-family: 'Alexandria', sans-serif; }
        body.theme-female ::-webkit-scrollbar-thumb { background: #d8b4fe; }
        .theme-female .glass-card {
            background: rgba(59,31,99,0.55); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255,255,255,0.07); box-shadow: 0 4px 24px rgba(0,0,0,0.2);
        }
        .theme-female .habit-active { background: rgba(232,121,249,0.12); border-color:#e879f9; }
        .theme-female .habit-active .icon-box { background:#e879f9; color:#fff; }
        .theme-female .habit-active .check-circle { background:#e879f9; border-color:#e879f9; color:#fff; }
        .theme-female .habit-active .habit-text { color:#f5d0fe; font-weight:700; }
        .theme-female .string { width:1px; background: linear-gradient(to bottom, rgba(255,255,255,0.05), rgba(255,255,255,0.5)); margin:0 auto; }
        .theme-female .btn-active-fard { border-color:#f0abfc; color:#f0abfc; background:rgba(240,171,252,0.1); font-weight:bold; }
        .theme-female .btn-active-sunnah { background: linear-gradient(to right, #f0abfc, #a855f7); color:#fff; border:none; font-weight:bold; box-shadow:0 0 10px rgba(232,121,249,0.35); }

        /* â”€â”€ WELCOME SCREEN â”€â”€ */
        #welcomeScreen { animation: fadeIn 0.4s ease-out; }
        .theme-option { transition: all 0.25s ease; }
        .theme-option.selected { border-color:#fbbf24; background:rgba(251,191,36,0.08); }
        .theme-option.selected-f { border-color:#f0abfc; background:rgba(240,171,252,0.08); }
        .setup-input:focus { box-shadow: 0 0 0 2px rgba(251,191,36,0.3); }

        /* â”€â”€ NAVIGATION â”€â”€ */
        .nav-item { position:relative; padding-bottom:4px; transition: color 0.25s, opacity 0.25s; }
        .nav-item.active { font-weight:700; }
        .nav-item.active::after { content:''; position:absolute; bottom:0; left:0; width:100%; height:2px; background:currentColor; border-radius:2px; }
        
        /* â”€â”€ DUAA PAGE â”€â”€ */
        .duaa-text { line-height:2.4; letter-spacing:0.01em; }
        .duaa-divider { width:60px; height:1px; background:currentColor; opacity:0.2; margin:0 auto; }

        /* â”€â”€ HABIT CARDS â”€â”€ */
        .habit-card { transition: all 0.2s ease; }
        .habit-card:active { transform: scale(0.97); }
        
        /* â”€â”€ PRAYER BUTTONS â”€â”€ */
        .prayer-btn { transition: all 0.2s ease; }
        .prayer-btn:active { transform: scale(0.95); }

        /* â”€â”€ PROGRESS RING â”€â”€ */
        .progress-ring circle { transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1); }

        /* â”€â”€ SAVE BUTTON PULSE â”€â”€ */
        .save-pulse { animation: savePulse 2s ease-in-out infinite; }
        @keyframes savePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255,255,255,0.15); }
            50% { box-shadow: 0 0 0 8px rgba(255,255,255,0); }
        }
        
        /* â”€â”€ STREAK BADGE â”€â”€ */
        .streak-badge { 
            background: linear-gradient(135deg, rgba(251,191,36,0.15), rgba(251,191,36,0.05));
            border: 1px solid rgba(251,191,36,0.3);
        }
        .streak-badge-f {
            background: linear-gradient(135deg, rgba(240,171,252,0.15), rgba(240,171,252,0.05));
            border: 1px solid rgba(240,171,252,0.3);
        }

        /* â”€â”€ TOAST NOTIFICATION â”€â”€ */
        #toast {
            position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
            background: rgba(20,20,20,0.95); color: #fff; border: 1px solid rgba(255,255,255,0.1);
            padding: 10px 20px; border-radius: 100px; font-size: 13px; font-family: 'Reem Kufi', sans-serif;
            backdrop-filter: blur(12px); z-index: 9999; opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); pointer-events: none;
            white-space: nowrap;
        }
        #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
        
        /* â”€â”€ WEEKLY DOTS â”€â”€ */
        .week-dot { width:8px; height:8px; border-radius:50%; transition: all 0.3s ease; }
        .week-dot.done-full { background: #fff; }
        .week-dot.done-full.female { background: #e879f9; }
        .week-dot.done-partial { background: rgba(255,255,255,0.35); }
        .week-dot.done-partial.female { background: rgba(232,121,249,0.4); }
        .week-dot.empty { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); }

        /* â”€â”€ SECTION STAGGER ANIMATION â”€â”€ */
        .stagger-1 { animation: slideUp 0.5s 0.05s ease-out both; }
        .stagger-2 { animation: slideUp 0.5s 0.1s ease-out both; }
        .stagger-3 { animation: slideUp 0.5s 0.15s ease-out both; }
        .stagger-4 { animation: slideUp 0.5s 0.2s ease-out both; }
        .stagger-5 { animation: slideUp 0.5s 0.25s ease-out both; }

        /* â”€â”€ SMOOTH PAGE TRANSITIONS â”€â”€ */
        .page-view { transition: opacity 0.3s ease, transform 0.3s ease; }
        .page-view.hidden { opacity: 0; pointer-events: none; position: absolute; top: 0; left: 0; right: 0; }
        
        /* â”€â”€ INPUT STYLES â”€â”€ */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }

        /* â”€â”€ PAGES LEFT BADGE FIX â”€â”€ */
        #pagesLeftBadge { display: block; }
        
        /* Loader Style */
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top: 3px solid #fbbf24;
            width: 40px; height: 40px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="min-h-screen text-zinc-100">

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOADING SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loadingScreen" class="fixed inset-0 z-[200] bg-black flex flex-col items-center justify-center transition-opacity duration-500 hidden">
    <div class="loader mb-4"></div>
    <p class="text-zinc-500 text-xs font-kufi animate-pulse">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     WELCOME / SETUP SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="welcomeScreen" class="fixed inset-0 z-[100] bg-black flex-col items-center justify-center p-4" style="display:none;">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-zinc-900 via-black to-black"></div>
    
    <!-- Subtle grid texture -->
    <div class="absolute inset-0 opacity-[0.025]" style="background-image: repeating-linear-gradient(0deg, #fff 0px, #fff 1px, transparent 1px, transparent 60px), repeating-linear-gradient(90deg, #fff 0px, #fff 1px, transparent 1px, transparent 60px);"></div>

    <div class="relative z-10 w-full max-w-sm">
        <!-- Logo mark -->
        <div class="text-center mb-8">
            <div class="inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-zinc-900 border border-zinc-800 mb-5 shadow-xl">
                <i class="fas fa-mosque text-2xl text-[#fbbf24]"></i>
            </div>
            <h1 class="text-2xl font-kufi font-bold text-white mb-1.5">Ø±ÙÙŠÙ‚ Ø±Ù…Ø¶Ø§Ù†</h1>
            <p class="text-zinc-500 text-sm">Ø³Ø¬Ù‘Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù„ØªØ¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ</p>
        </div>

        <div class="bg-zinc-950 border border-zinc-800 rounded-2xl p-6 shadow-2xl space-y-5">
            <div>
                <label class="block text-xs font-medium text-zinc-400 mb-2 tracking-wide uppercase">Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ±ÙŠÙ…</label>
                <input type="text" id="setupName" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù‡Ù†Ø§..." 
                    class="setup-input w-full bg-black border border-zinc-800 rounded-xl px-4 py-3 text-white text-sm focus:outline-none focus:border-zinc-600 transition-all text-right placeholder-zinc-700">
            </div>

            <div>
                <label class="block text-xs font-medium text-zinc-400 mb-3 tracking-wide uppercase">Ø§Ù„Ø«ÙŠÙ…</label>
                <div class="grid grid-cols-2 gap-3">
                    <div onclick="window.selectSetupTheme('male')" id="themeMale" class="theme-option selected cursor-pointer rounded-xl p-4 flex flex-col items-center gap-2 bg-zinc-900 border-2 border-transparent transition-all">
                        <i class="fas fa-user-tie text-[#fbbf24] text-xl"></i>
                        <span class="text-xs font-bold text-zinc-300">Ø´Ø¨Ø§Ø¨</span>
                    </div>
                    <div onclick="window.selectSetupTheme('female')" id="themeFemale" class="theme-option cursor-pointer rounded-xl p-4 flex flex-col items-center gap-2 bg-zinc-900 border-2 border-transparent transition-all">
                        <i class="fas fa-user-hijab text-[#f0abfc] text-xl"></i>
                        <span class="text-xs font-bold text-zinc-300">Ø¨Ù†Ø§Øª</span>
                    </div>
                </div>
            </div>

            <button onclick="window.finishSetup()" class="w-full bg-white text-black font-bold font-kufi py-3 rounded-xl hover:bg-zinc-100 active:scale-[0.98] transition-all text-sm tracking-wide shadow-lg mt-2">
                Ø§Ø¨Ø¯Ø£ Ø±Ø­Ù„ØªÙƒ
            </button>
        </div>

        <p class="text-center text-zinc-700 text-[11px] font-eng mt-6 tracking-widest uppercase">Ramadan Companion</p>
    </div>
</div>

<!-- Toast -->
<div id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP CONTAINER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="app-container" class="opacity-0 transition-opacity duration-700 min-h-screen hidden"></div>

<script type="module">
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE CONFIG & INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";

// ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù…Ø¯Ù…Ø¬Ø© Ù‡Ù†Ø§ 
const firebaseConfig = {
  apiKey: "AIzaSyBtHvklnxlP7ZgTvwJrpgMz4cbWiuhq9TM",
  authDomain: "create-project-36d4c.firebaseapp.com",
  projectId: "create-project-36d4c",
  storageBucket: "create-project-36d4c.firebasestorage.app",
  messagingSenderId: "384696044918",
  appId: "1:384696044918:web:f78daf55009be623b1fe57",
  measurementId: "G-6Q499CKMZY"
};

let app, db, analytics;
try {
    app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    analytics = getAnalytics(app);
    console.log("ğŸ”¥ Firebase Connected Successfully");
} catch (e) {
    console.error("Firebase Error:", e);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONSTANTS & CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const PRAYERS_CONFIG = {
    fajr:    { label: 'Ø§Ù„ÙÙØ¬Ù’Ø±',  fard: true,  sunnah: true  },
    duha:    { label: 'Ø§Ù„Ø¶ÙÙ‘Ø­ÙÙ‰', fard: false, sunnah: true  },
    dhuhr:   { label: 'Ø§Ù„Ø¸ÙÙ‘Ù‡Ù’Ø±', fard: true,  sunnah: true  },
    asr:     { label: 'Ø§Ù„Ø¹ÙØµÙ’Ø±',  fard: true,  sunnah: true  },
    maghrib: { label: 'Ø§Ù„Ù…ÙØºÙ’Ø±ÙØ¨', fard: true,  sunnah: true  },
    isha:    { label: 'Ø§Ù„Ø¹ÙØ´ÙØ§Ø¡', fard: true,  sunnah: true  }
};

let currentDate = new Date().toISOString().split('T')[0];
let appData = {};
let currentUser = null;
let currentTheme = 'male';
let setupThemeSelected = 'male';

const FOOTER_HTML = `
<div class="mt-12 pb-28 pt-10 border-t border-white/5">
    <div class="text-center space-y-6">
        <div class="duaa-divider mb-6"></div>
        <div class="text-sm font-amiri leading-loose opacity-60 space-y-1">
            <div>Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</div>
            <div class="text-xs">Ø¹Ù† <span class="font-bold opacity-90">Ø¹Ø·ÙŠØ© Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Â· Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³ÙŠØ¯ Ø¹Ù„ÙŠÙˆÙ‡ Â· Ø­Ù…Ø²Ø© Ù…Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…</span></div>
            <div class="text-xs">ÙˆØ¬Ù…ÙŠØ¹ Ù…ÙˆØªÙ‰ Ø§Ù„Ù…Ø³Ù„Ù…ÙŠÙ† ğŸ¤</div>
        </div>
        <div class="duaa-divider"></div>
        <div class="text-[10px] font-eng tracking-[0.18em] uppercase opacity-30 mt-4">
            Designed & Developed by<br>
            <span class="font-semibold opacity-80 mt-1 inline-block">Eng. Mahmoud Attia Ibrahim</span>
        </div>
    </div>
</div>`;

const DUAA_PAGE = `
<div id="duaa-view" class="hidden min-h-screen animate-fade-in">
    <div class="container mx-auto px-4 max-w-xl pt-10 pb-12 text-center">

        <!-- Section header -->
        <div class="mb-10">
            <div class="inline-flex items-center justify-center w-12 h-12 rounded-xl bg-white/5 border border-white/8 mb-5">
                <i class="fas fa-hands-praying text-lg opacity-70"></i>
            </div>
            <h2 class="text-2xl md:text-3xl font-amiri font-bold mb-2">Ø¯Ø¹Ø§Ø¡ Ù„Ù„Ù…ÙˆØªÙ‰</h2>
            <div class="duaa-divider mx-auto"></div>
        </div>

        <!-- Duaa body -->
        <div class="font-amiri text-lg md:text-xl duaa-text space-y-8 opacity-85">
            <p class="font-bold opacity-100">Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ ØµØ¯Ù‚Ø© Ø¬Ø§Ø±ÙŠØ©</p>

            <p>Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ Ù†ÙˆØ±Ù‹Ø§ ÙÙŠ Ù‚Ø¨ÙˆØ±Ù‡Ù…ØŒ<br>ÙˆØ±Ø§Ø­Ø©Ù‹ Ù„Ø£Ø±ÙˆØ§Ø­Ù‡Ù….</p>

            <div class="duaa-divider mx-auto !opacity-10"></div>

            <p>
                Ø§Ù„Ù„Ù‡Ù… Ø§ØºÙØ± Ù„Ù‡Ù… ÙˆØ§Ø±Ø­Ù…Ù‡Ù…ØŒ<br>
                ÙˆØ¹Ø§ÙÙ‡Ù… ÙˆØ§Ø¹ÙÙ Ø¹Ù†Ù‡Ù…ØŒ<br>
                ÙˆØ£ÙƒØ±Ù… Ù†ÙØ²Ù„Ù‡Ù…ØŒ ÙˆÙˆØ³Ù‘Ø¹ Ù…ÙØ¯Ø®Ù„Ù‡Ù…ØŒ<br>
                ÙˆØ§ØºØ³Ù„Ù‡Ù… Ø¨Ø§Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„Ø«Ù„Ø¬ ÙˆØ§Ù„Ø¨Ø±Ø¯ØŒ<br>
                ÙˆÙ†Ù‚Ù‘Ù‡Ù… Ù…Ù† Ø§Ù„Ø®Ø·Ø§ÙŠØ§ ÙƒÙ…Ø§ ÙŠÙÙ†Ù‚Ù‘Ù‰ Ø§Ù„Ø«ÙˆØ¨ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ù…Ù† Ø§Ù„Ø¯Ù†Ø³.
            </p>

            <p>
                Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‚Ø¨ÙˆØ±Ù‡Ù… Ø±ÙˆØ¶Ø©Ù‹ Ù…Ù† Ø±ÙŠØ§Ø¶ Ø§Ù„Ø¬Ù†Ø©ØŒ<br>
                ÙˆØ§Ø±Ø²Ù‚Ù‡Ù… Ø§Ù„ÙØ±Ø¯ÙˆØ³ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¨ØºÙŠØ± Ø­Ø³Ø§Ø¨ ÙˆÙ„Ø§ Ø³Ø§Ø¨Ù‚Ø© Ø¹Ø°Ø§Ø¨.
            </p>

            <div class="duaa-divider mx-auto !opacity-10"></div>

            <!-- Names block -->
            <div class="py-4">
                <div class="text-sm font-kufi opacity-60 mb-4">ğŸ¤ Ø¹Ù† Ø£Ø±ÙˆØ§Ø­</div>
                <div class="space-y-2 font-bold text-xl md:text-2xl opacity-95">
                    <div>Ø¹Ø·ÙŠØ© Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…</div>
                    <div>Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ø³ÙŠØ¯ Ø¹Ù„ÙŠÙˆÙ‡</div>
                    <div>Ø­Ù…Ø²Ø© Ù…Ø­Ù…Ø¯ Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ…</div>
                </div>
                <div class="mt-4 text-base opacity-60">ÙˆØ¬Ù…ÙŠØ¹ Ù…ÙˆØªÙ‰ Ø§Ù„Ù…Ø³Ù„Ù…ÙŠÙ†</div>
                <div class="mt-1.5 text-xs opacity-40">Ø±Ø­Ù…Ù‡Ù… Ø§Ù„Ù„Ù‡ Ø±Ø­Ù…Ø©Ù‹ ÙˆØ§Ø³Ø¹Ø©</div>
            </div>
        </div>

        ${FOOTER_HTML}
    </div>
</div>`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEMPLATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const MALE_TEMPLATE = `
<!-- Background -->
<div class="fixed inset-0 z-0 pointer-events-none">
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-[#1a1a1a] via-[#050505] to-black"></div>
    <div class="absolute top-[-15%] left-[15%] w-[350px] h-[350px] bg-amber-400/5 blur-[120px] rounded-full pointer-events-none"></div>
    <div class="absolute top-[-15%] right-[15%] w-[350px] h-[350px] bg-teal-400/4 blur-[120px] rounded-full pointer-events-none"></div>
</div>

<!-- Header + Nav -->
<header class="relative z-30 px-6 py-5 flex justify-between items-center border-b border-white/[0.04]">
    <nav class="flex gap-6 font-kufi text-sm text-zinc-500">
        <button onclick="window.toggleView('dashboard')" id="nav-dashboard" class="nav-item active text-zinc-200 hover:text-white">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button onclick="window.toggleView('duaa')" id="nav-duaa" class="nav-item hover:text-zinc-200">Ø¯Ø¹Ø§Ø¡</button>
    </nav>
    <div id="streakBadgeM" class="streak-badge hidden items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold text-amber-300 font-kufi">
        <i class="fas fa-fire text-amber-400 text-[10px]"></i>
        <span id="streakCountM">0</span> ÙŠÙˆÙ…
    </div>
</header>

<!-- Dashboard -->
<div id="dashboard-view" class="animate-fade-in">
    <!-- Hanging decorations -->
    <div class="fixed top-0 left-0 w-full h-56 z-20 pointer-events-none overflow-hidden">
        <div class="absolute top-0 left-[5%] animate-swing-4 origin-top"><div class="lantern-string h-10 opacity-40"></div><div class="text-amber-400/60 text-sm -mt-0.5 ml-1"><i class="fas fa-star"></i></div></div>
        <div class="absolute top-0 left-[16%] animate-swing-2 origin-top"><div class="lantern-string h-28"></div><div class="text-ramadan-gold text-4xl -mt-2 drop-shadow-[0_0_12px_rgba(251,191,36,0.5)]"><i class="fas fa-lightbulb"></i></div></div>
        <div class="absolute top-0 left-[30%] animate-swing-3 origin-top"><div class="lantern-string h-20"></div><div class="text-rose-400/80 text-2xl -mt-1"><i class="fas fa-moon"></i></div></div>
        <div class="absolute top-0 left-1/2 -translate-x-1/2 animate-swing-1 origin-top"><div class="lantern-string h-36"></div><div class="text-white text-5xl -mt-3 drop-shadow-[0_0_20px_rgba(255,255,255,0.3)]"><i class="fas fa-moon"></i></div></div>
        <div class="absolute top-0 right-[30%] animate-swing-3 origin-top"><div class="lantern-string h-16"></div><div class="text-teal-400/80 text-xl -mt-1"><i class="fas fa-star-and-crescent"></i></div></div>
        <div class="absolute top-0 right-[16%] animate-swing-2 origin-top"><div class="lantern-string h-32"></div><div class="text-ramadan-gold text-4xl -mt-2 drop-shadow-[0_0_12px_rgba(251,191,36,0.5)]"><i class="fas fa-kaaba"></i></div></div>
        <div class="absolute top-0 right-[5%] animate-swing-4 origin-top"><div class="lantern-string h-10 opacity-40"></div><div class="text-rose-400/60 text-sm -mt-0.5 mr-1"><i class="fas fa-star"></i></div></div>
    </div>

    <!-- Header info -->
    <div class="relative z-20 pt-2 pb-6 px-4 text-center">
        <div class="animate-float inline-block mb-4 relative">
            <div class="absolute inset-0 bg-white/5 blur-2xl rounded-full"></div>
            <i class="fas fa-mosque text-5xl md:text-6xl text-gradient-white relative"></i>
        </div>
        <h1 class="font-kufi text-4xl md:text-5xl font-bold text-white mb-1.5 tracking-wide">Ø±ÙÙÙÙŠÙ‚Ù <span class="text-zinc-500">Ø±ÙÙ…ÙØ¶ÙØ§Ù†</span></h1>
        <div class="text-base font-kufi text-zinc-500 mb-6">Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù ÙƒÙØ±ÙÙŠÙ…ÙŒ ÙŠÙØ§ <span id="userNameDisplayM" class="text-zinc-200 font-bold">...</span></div>

        <!-- Date navigator -->
        <div class="inline-flex items-center gap-3 bg-zinc-950/90 rounded-full px-4 py-2 border border-zinc-800 backdrop-blur-md">
            <button onclick="window.changeDate(-1)" class="text-zinc-600 hover:text-white transition-colors p-1 hover:bg-white/5 rounded-full"><i class="fas fa-chevron-right text-xs"></i></button>
            <span id="currentDateDisplay" class="font-bold text-sm text-zinc-200 min-w-[130px] text-center font-kufi">--</span>
            <button onclick="window.changeDate(1)" class="text-zinc-600 hover:text-white transition-colors p-1 hover:bg-white/5 rounded-full"><i class="fas fa-chevron-left text-xs"></i></button>
        </div>
    </div>

    <!-- Weekly overview strip -->
    <div class="relative z-10 px-4 mb-4 stagger-1">
        <div class="glass-panel rounded-xl px-4 py-3 flex items-center justify-between max-w-5xl mx-auto">
            <span class="text-[10px] text-zinc-600 uppercase tracking-widest font-eng">Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span>
            <div id="weeklyDots" class="flex gap-2"></div>
        </div>
    </div>

    <main class="relative z-10 container mx-auto px-3 md:px-4 max-w-5xl pb-28">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">

            <!-- LEFT COLUMN -->
            <div class="space-y-4">
                <!-- Prayers -->
                <div class="glass-panel rounded-xl p-5 stagger-2">
                    <div class="flex items-center gap-3 mb-4 pb-3 border-b border-zinc-900">
                        <div class="w-8 h-8 rounded-lg bg-amber-400/10 flex items-center justify-center">
                            <i class="fas fa-praying-hands text-amber-400 text-sm"></i>
                        </div>
                        <h2 class="font-bold text-zinc-100 font-kufi">Ø§Ù„ØµÙÙ‘Ù„ÙÙˆÙØ§ØªÙ Ø§Ù„Ø®ÙÙ…Ù’Ø³</h2>
                    </div>
                    <div id="prayersList" class="space-y-1"></div>
                </div>

                <!-- Habits -->
                <div class="glass-panel rounded-xl p-5 stagger-3">
                    <div class="flex items-center gap-3 mb-4 pb-3 border-b border-zinc-900">
                        <div class="w-8 h-8 rounded-lg bg-teal-400/10 flex items-center justify-center">
                            <i class="fas fa-star text-teal-400 text-sm"></i>
                        </div>
                        <h2 class="font-bold text-zinc-100 font-kufi">Ø§Ù„Ø¹ÙØ¨ÙØ§Ø¯ÙØ§ØªÙ Ø§Ù„ÙŠÙÙˆÙ’Ù…ÙÙŠÙÙ‘Ø©</h2>
                    </div>

                    <div class="mb-4">
                        <label class="block text-xs text-zinc-500 mb-2">ÙˆÙØ±Ù’Ø¯Ù Ø§Ù„Ù‚ÙØ±Ù’Ø¢Ù† â€” Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª</label>
                        <div class="relative">
                            <i class="fas fa-book-open absolute right-4 top-1/2 -translate-y-1/2 text-zinc-600 text-sm"></i>
                            <input type="number" id="quranPages" placeholder="0" class="w-full bg-black/60 border border-zinc-800 focus:border-zinc-600 text-white text-base rounded-lg py-2.5 pr-11 pl-4 focus:outline-none transition-all placeholder-zinc-800">
                        </div>
                    </div>

                    <div class="space-y-2">
                        <div id="taraweehCard" onclick="window.toggleHabit('taraweeh')" class="habit-card cursor-pointer flex items-center justify-between p-3 rounded-lg border border-zinc-800/60 bg-zinc-900/20 hover:border-zinc-600 hover:bg-zinc-900/60 select-none">
                            <div class="flex items-center gap-3">
                                <div class="w-7 h-7 rounded-full bg-zinc-800 flex items-center justify-center text-zinc-500 text-xs shrink-0"><i class="fas fa-moon"></i></div>
                                <span class="font-medium text-sm text-zinc-400">ØµÙÙ„ÙØ§Ø©Ù Ø§Ù„ØªÙÙ‘Ø±ÙØ§ÙˆÙÙŠØ­</span>
                            </div>
                            <div class="check-circle w-5 h-5 rounded-full border border-zinc-700 flex items-center justify-center shrink-0"><i class="fas fa-check text-[9px] text-transparent"></i></div>
                        </div>
                        <div id="azkarCard" onclick="window.toggleHabit('azkar')" class="habit-card cursor-pointer flex items-center justify-between p-3 rounded-lg border border-zinc-800/60 bg-zinc-900/20 hover:border-zinc-600 hover:bg-zinc-900/60 select-none">
                            <div class="flex items-center gap-3">
                                <div class="w-7 h-7 rounded-full bg-zinc-800 flex items-center justify-center text-zinc-500 text-xs shrink-0"><i class="fas fa-hands-praying"></i></div>
                                <span class="font-medium text-sm text-zinc-400">Ø£ÙØ°Ù’ÙƒÙØ§Ø±Ù Ø§Ù„ØµÙÙ‘Ø¨ÙØ§Ø­Ù ÙˆÙØ§Ù„Ù…ÙØ³ÙØ§Ø¡</span>
                            </div>
                            <div class="check-circle w-5 h-5 rounded-full border border-zinc-700 flex items-center justify-center shrink-0"><i class="fas fa-check text-[9px] text-transparent"></i></div>
                        </div>
                        <div id="gymCard" onclick="window.toggleHabit('gym')" class="habit-card cursor-pointer flex items-center justify-between p-3 rounded-lg border border-zinc-800/60 bg-zinc-900/20 hover:border-zinc-600 hover:bg-zinc-900/60 select-none">
                            <div class="flex items-center gap-3">
                                <div class="w-7 h-7 rounded-full bg-zinc-800 flex items-center justify-center text-zinc-500 text-xs shrink-0"><i class="fas fa-dumbbell"></i></div>
                                <span class="font-medium text-sm text-zinc-400">Ø±ÙÙŠÙØ§Ø¶ÙØ© / Ù…ÙØ´Ù’ÙŠ</span>
                            </div>
                            <div class="check-circle w-5 h-5 rounded-full border border-zinc-700 flex items-center justify-center shrink-0"><i class="fas fa-check text-[9px] text-transparent"></i></div>
                        </div>
                    </div>

                    <div class="mt-4">
                        <label class="block text-xs text-zinc-500 mb-2">Ø³ÙØ§Ø¹ÙØ§ØªÙ Ø§Ù„Ø¹ÙÙ…ÙÙ„ / Ø§Ù„Ù…ÙØ°ÙØ§ÙƒÙØ±ÙØ©</label>
                        <input type="number" id="workHours" placeholder="0" min="0" step="0.5" class="w-full bg-black/60 border border-zinc-800 focus:border-zinc-600 text-white rounded-lg py-2.5 px-4 focus:outline-none transition-all placeholder-zinc-800">
                    </div>
                </div>

                <!-- Benefit log -->
                <div class="glass-panel rounded-xl p-5 stagger-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center">
                            <i class="fas fa-headphones text-zinc-400 text-sm"></i>
                        </div>
                        <h2 class="font-bold text-zinc-300 font-kufi text-sm">ÙÙØ§Ø¦ÙØ¯ÙØ©Ù Ø§Ù„ÙŠÙÙˆÙ’Ù…</h2>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="podcastInput" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¯Ø±Ø³ Ø£Ùˆ Ø§Ù„ÙØ§Ø¦Ø¯Ø©..." class="flex-1 bg-black/60 border border-zinc-800 focus:border-zinc-600 text-white text-sm rounded-lg py-2.5 px-3 focus:outline-none transition-all placeholder-zinc-800">
                        <button onclick="window.addPodcast()" class="bg-zinc-800 hover:bg-zinc-700 text-white px-3.5 rounded-lg transition-colors border border-zinc-700 hover:border-zinc-500 active:scale-95"><i class="fas fa-plus text-sm"></i></button>
                    </div>
                </div>
            </div>

            <!-- RIGHT COLUMN -->
            <div class="space-y-4">
                <!-- Quran progress -->
                <div class="glass-panel rounded-xl p-6 text-center stagger-2">
                    <h3 class="font-bold text-zinc-100 font-kufi mb-1">Ø®ÙØªÙ’Ù…ÙØ©Ù Ø§Ù„Ù‚ÙØ±Ù’Ø¢Ù†</h3>
                    <p class="text-zinc-600 text-xs mb-6">ØªÙÙ‚ÙØ¯ÙÙ‘Ù…ÙÙƒ ÙÙÙŠ Ø§Ù„Ø®ÙØªÙ’Ù…ÙØ© Ø§Ù„Ø­ÙØ§Ù„ÙÙŠÙÙ‘Ø©</p>

                    <div class="relative w-36 h-36 md:w-44 md:h-44 mx-auto mb-6">
                        <svg class="w-full h-full -rotate-90 progress-ring">
                            <circle cx="50%" cy="50%" r="45%" stroke="#1c1c1e" stroke-width="8" fill="transparent"/>
                            <circle id="khatmaCircle" cx="50%" cy="50%" r="45%" stroke="#ffffff" stroke-width="8" fill="transparent" stroke-dasharray="283" stroke-dashoffset="283" stroke-linecap="round"/>
                        </svg>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="khatmaPct" class="text-3xl font-bold text-white font-kufi">0%</span>
                            <span id="khatmaLabel" class="text-[10px] text-zinc-500 mt-1.5 bg-zinc-900 px-2.5 py-1 rounded-full border border-zinc-800 font-kufi">Ø§Ù„Ø®ÙØªÙ’Ù…ÙØ© 1</span>
                        </div>
                    </div>

                    <div class="flex justify-center gap-8">
                        <div class="text-center">
                            <div id="totalPagesDisplay" class="text-xl font-bold text-white font-kufi">0</div>
                            <div class="text-[10px] text-zinc-600 mt-0.5">ØµÙÙÙ’Ø­ÙØ© Ù…ÙÙ‚Ù’Ø±ÙÙˆØ¡ÙØ©</div>
                        </div>
                        <div class="w-px bg-zinc-800 self-stretch"></div>
                        <div class="text-center">
                            <div id="pagesLeftBadge" class="text-xl font-bold text-zinc-400 font-kufi">604</div>
                            <div class="text-[10px] text-zinc-600 mt-0.5">ØµÙÙÙ’Ø­ÙØ© Ù…ÙØªÙØ¨ÙÙ‚ÙÙ‘ÙŠÙØ©</div>
                        </div>
                    </div>
                </div>

                <!-- Quick stats -->
                <div class="grid grid-cols-2 gap-3 stagger-3">
                    <div class="glass-panel p-4 rounded-xl text-center">
                        <div class="text-[10px] text-zinc-600 mb-1.5 uppercase tracking-wide">Ø§Ù„Ù’ØªÙØ²ÙØ§Ù…Ù Ø§Ù„ÙÙØ±Ù’Ø¶</div>
                        <div id="prayerStat" class="text-xl font-bold text-white font-kufi">0%</div>
                    </div>
                    <div class="glass-panel p-4 rounded-xl text-center">
                        <div class="text-[10px] text-zinc-600 mb-1.5 uppercase tracking-wide">Ø§Ù„Ù’ØªÙØ²ÙØ§Ù…Ù Ø§Ù„Ø³ÙÙ‘Ù†ÙÙ†</div>
                        <div id="sunnahStat" class="text-xl font-bold text-white font-kufi">0%</div>
                    </div>
                    <div class="glass-panel p-4 rounded-xl text-center">
                        <div class="text-[10px] text-zinc-600 mb-1.5 uppercase tracking-wide">ØªÙØ±ÙØ§ÙˆÙÙŠØ­</div>
                        <div id="taraweehCountDisplay" class="text-xl font-bold text-white font-kufi">0</div>
                    </div>
                    <div class="glass-panel p-4 rounded-xl text-center">
                        <div class="text-[10px] text-zinc-600 mb-1.5 uppercase tracking-wide">Ø±ÙÙŠÙØ§Ø¶ÙØ©</div>
                        <div id="gymCountDisplay" class="text-xl font-bold text-white font-kufi">0</div>
                    </div>
                </div>

                <!-- History log -->
                <div class="glass-panel rounded-xl p-5 stagger-4">
                    <div class="flex items-center gap-3 mb-3">
                        <i class="fas fa-history text-zinc-600 text-sm"></i>
                        <h2 class="font-bold text-zinc-400 font-kufi text-sm">Ø³ÙØ¬ÙÙ„ÙÙ‘ Ø§Ù„ÙÙÙˆÙØ§Ø¦ÙØ¯</h2>
                    </div>
                    <div id="historyLog" class="max-h-52 overflow-y-auto space-y-1.5 pr-1"></div>
                </div>

                <div class="text-center stagger-5">
                    <button onclick="window.resetData()" class="text-zinc-700 hover:text-red-500 text-xs transition-colors flex items-center justify-center gap-1.5 mx-auto py-2 px-4 hover:opacity-100 opacity-50">
                        <i class="fas fa-trash-alt"></i> ØªÙØµÙ’ÙÙÙŠØ±Ù Ø¬ÙÙ…ÙÙŠØ¹Ù Ø§Ù„Ø¨ÙÙŠÙØ§Ù†ÙØ§Øª
                    </button>
                </div>
            </div>
        </div>

        ${FOOTER_HTML}
    </main>

    <!-- Save button -->
    <div class="fixed bottom-0 left-0 w-full px-4 pb-6 pt-4 z-50 bg-gradient-to-t from-black via-black/80 to-transparent pointer-events-none">
        <button onclick="window.saveData()" id="saveBtn" class="save-pulse pointer-events-auto w-full max-w-md mx-auto block bg-white hover:bg-zinc-100 text-black font-bold text-sm py-3.5 rounded-xl shadow-[0_8px_32px_rgba(255,255,255,0.12)] active:scale-[0.98] transition-all font-kufi border border-white/30 flex items-center justify-center gap-2">
            <i class="fas fa-check-circle"></i> Ø­ÙÙÙ’Ø¸Ù Ø¥ÙÙ†Ù’Ø¬ÙØ§Ø²Ù Ø§Ù„ÙŠÙÙˆÙ’Ù…
        </button>
    </div>
</div>
${DUAA_PAGE}
`;

const FEMALE_TEMPLATE = `
<!-- Background -->
<div class="fixed inset-0 pointer-events-none z-0">
    <div class="absolute inset-0 bg-[radial-gradient(circle_at_top,_var(--tw-gradient-stops))] from-[#4c1d95] via-[#241245] to-[#180a33]"></div>
    <div class="absolute top-0 left-0 w-full h-full opacity-[0.035]" style="background-image: url('data:image/svg+xml,%3Csvg width=\\'60\\' height=\\'60\\' viewBox=\\'0 0 60 60\\' xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cpath d=\\'M30 30 L60 0 L60 60 Z M0 0 L30 30 L0 60 Z\\' fill=\\'%23ffffff\\'/%3E%3C/svg%3E');"></div>
</div>

<!-- Header + Nav -->
<header class="relative z-20 px-6 py-5 flex justify-between items-center border-b border-white/[0.04]">
    <nav class="flex gap-6 font-kufi text-sm text-purple-300">
        <button onclick="window.toggleView('dashboard')" id="nav-dashboard" class="nav-item active text-purple-100 hover:text-white">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <button onclick="window.toggleView('duaa')" id="nav-duaa" class="nav-item hover:text-purple-100">Ø¯Ø¹Ø§Ø¡</button>
    </nav>
    <div id="streakBadgeF" class="streak-badge-f hidden items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold text-fuchsia-300 font-kufi">
        <i class="fas fa-fire text-fuchsia-400 text-[10px]"></i>
        <span id="streakCountF">0</span> ÙŠÙˆÙ…
    </div>
</header>

<!-- Dashboard -->
<div id="dashboard-view" class="animate-fade-in">
    <!-- Decorations -->
    <div class="fixed top-0 w-full h-32 z-10 pointer-events-none flex justify-between px-4">
        <div class="relative w-10 h-32 animate-swing-1 origin-top"><div class="string h-16"></div><i class="fas fa-lightbulb text-theme-gold text-3xl absolute bottom-8 left-1/2 -translate-x-1/2 drop-shadow-[0_0_12px_rgba(252,211,77,0.5)]"></i></div>
        <div class="relative w-8 h-24 animate-swing-2 origin-top hidden xs:block"><div class="string h-12"></div><i class="fas fa-star text-theme-primary text-lg absolute bottom-7 left-1/2 -translate-x-1/2"></i></div>
        <div class="relative w-8 h-28 animate-swing-3 origin-top hidden xs:block"><div class="string h-14"></div><i class="fas fa-moon text-theme-accent text-xl absolute bottom-7 left-1/2 -translate-x-1/2"></i></div>
        <div class="relative w-10 h-28 animate-swing-1 origin-top"><div class="string h-14"></div><i class="fas fa-lightbulb text-theme-gold text-3xl absolute bottom-8 left-1/2 -translate-x-1/2 drop-shadow-[0_0_12px_rgba(252,211,77,0.5)]"></i></div>
    </div>

    <!-- Header info -->
    <div class="relative z-20 pt-4 pb-5 px-4 text-center">
        <div class="animate-float inline-block mb-3 mt-4">
            <div class="absolute inset-0 bg-white/5 blur-xl rounded-full"></div>
            <i class="fas fa-mosque text-5xl text-theme-accent drop-shadow-lg opacity-85 relative"></i>
        </div>
        <h1 class="font-kufi text-3xl xs:text-4xl font-bold mb-1.5 tracking-wide">Ø±ÙÙÙÙŠÙ‚Ù <span class="text-theme-accent">Ø±ÙÙ…ÙØ¶ÙØ§Ù†</span></h1>
        <div class="inline-flex items-center gap-1.5 bg-white/5 rounded-full px-4 py-1.5 mb-4 border border-white/8 text-sm text-purple-100 font-kufi">
            Ø±ÙÙ…ÙØ¶ÙØ§Ù†Ù ÙƒÙØ±ÙÙŠÙ…ÙŒ ÙŠÙØ§ <span id="userNameDisplayF" class="text-theme-accent font-bold mr-1">...</span>
            <i class="fas fa-heart text-theme-accent text-[10px]"></i>
        </div>

        <!-- Date navigator -->
        <div class="flex items-center justify-between w-full max-w-[280px] mx-auto bg-theme-surface/60 backdrop-blur-md rounded-xl p-1 border border-white/8">
            <button onclick="window.changeDate(-1)" class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/5 text-theme-accent hover:bg-theme-accent hover:text-white transition-all active:scale-95"><i class="fas fa-chevron-right text-xs"></i></button>
            <span id="currentDateDisplay" class="font-bold text-sm text-white font-kufi min-w-[110px] text-center">--</span>
            <button onclick="window.changeDate(1)" class="w-9 h-9 flex items-center justify-center rounded-lg bg-white/5 text-theme-accent hover:bg-theme-accent hover:text-white transition-all active:scale-95"><i class="fas fa-chevron-left text-xs"></i></button>
        </div>
    </div>

    <!-- Weekly dots -->
    <div class="relative z-20 px-4 mb-3 stagger-1">
        <div class="glass-card rounded-xl px-4 py-2.5 flex items-center justify-between">
            <span class="text-[10px] text-purple-400 uppercase tracking-widest font-eng opacity-60">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</span>
            <div id="weeklyDots" class="flex gap-2"></div>
        </div>
    </div>

    <main class="relative z-20 container mx-auto px-3 w-full pb-6 flex flex-col gap-3">
        <!-- Prayers -->
        <div class="glass-card rounded-2xl p-4 stagger-2">
            <div class="flex items-center gap-2 mb-3 pb-2 border-b border-white/5">
                <div class="w-7 h-7 rounded-lg bg-theme-accent/10 flex items-center justify-center">
                    <i class="fas fa-mosque text-theme-accent text-xs"></i>
                </div>
                <h2 class="text-base font-bold text-theme-primary font-kufi">Ø§Ù„ØµÙÙ‘Ù„ÙÙˆÙØ§ØªÙ Ø§Ù„Ø®ÙÙ…Ù’Ø³</h2>
            </div>
            <div id="prayersList" class="space-y-2"></div>
        </div>

        <!-- Habits -->
        <div class="glass-card rounded-2xl p-4 stagger-3">
            <div class="flex items-center gap-2 mb-3 pb-2 border-b border-white/5">
                <div class="w-7 h-7 rounded-lg bg-theme-gold/10 flex items-center justify-center">
                    <i class="fas fa-star text-theme-gold text-xs"></i>
                </div>
                <h2 class="text-base font-bold text-theme-accent font-kufi">ÙˆÙØ±Ù’Ø¯ÙŒ ÙˆÙØ¹ÙØ¨ÙØ§Ø¯ÙØ©</h2>
            </div>

            <div class="bg-black/20 rounded-xl p-3 mb-3 border border-white/5">
                <label class="block text-[11px] text-purple-300 mb-1.5 font-kufi opacity-70">ÙˆÙØ±Ù’Ø¯Ù Ø§Ù„Ù‚ÙØ±Ù’Ø¢Ù†Ù Ø§Ù„ÙŠÙÙˆÙ’Ù… â€” ØµÙÙÙ’Ø­ÙØ©</label>
                <div class="flex items-center gap-3">
                    <i class="fas fa-book-open text-theme-accent"></i>
                    <input type="number" id="quranPages" placeholder="0" class="w-full bg-transparent text-xl font-bold text-white placeholder-white/20 focus:outline-none text-center border-b border-white/10 focus:border-theme-accent transition-colors pb-1">
                </div>
            </div>

            <div class="space-y-2">
                <div id="taraweehCard" onclick="window.toggleHabit('taraweeh')" class="habit-card flex items-center justify-between p-3 rounded-xl border border-white/5 bg-white/5 cursor-pointer transition-all select-none">
                    <div class="flex items-center gap-3"><div class="icon-box w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-purple-300 transition-colors text-sm"><i class="fas fa-moon"></i></div><span class="habit-text font-medium text-sm font-kufi">ØµÙÙ„ÙØ§Ø©Ù Ø§Ù„ØªÙÙ‘Ø±ÙØ§ÙˆÙÙŠØ­</span></div>
                    <div class="check-circle w-5 h-5 rounded-full border-2 border-white/20 flex items-center justify-center transition-colors"><i class="fas fa-check text-[9px]"></i></div>
                </div>
                <div id="tahajjudCard" onclick="window.toggleHabit('tahajjud')" class="habit-card flex items-center justify-between p-3 rounded-xl border border-white/5 bg-white/5 cursor-pointer transition-all select-none">
                    <div class="flex items-center gap-3"><div class="icon-box w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-purple-300 transition-colors text-sm"><i class="fas fa-cloud-moon"></i></div><span class="habit-text font-medium text-sm font-kufi">ØµÙÙ„ÙØ§Ø©Ù Ø§Ù„ØªÙÙ‘Ù‡ÙØ¬ÙÙ‘Ø¯</span></div>
                    <div class="check-circle w-5 h-5 rounded-full border-2 border-white/20 flex items-center justify-center transition-colors"><i class="fas fa-check text-[9px]"></i></div>
                </div>
                <div id="azkarCard" onclick="window.toggleHabit('azkar')" class="habit-card flex items-center justify-between p-3 rounded-xl border border-white/5 bg-white/5 cursor-pointer transition-all select-none">
                    <div class="flex items-center gap-3"><div class="icon-box w-8 h-8 rounded-lg bg-white/5 flex items-center justify-center text-purple-300 transition-colors text-sm"><i class="fas fa-hands-praying"></i></div><span class="habit-text font-medium text-sm font-kufi">Ø£ÙØ°Ù’ÙƒÙØ§Ø±Ù Ø§Ù„ØµÙÙ‘Ø¨ÙØ§Ø­Ù ÙˆÙØ§Ù„Ù…ÙØ³ÙØ§Ø¡</span></div>
                    <div class="check-circle w-5 h-5 rounded-full border-2 border-white/20 flex items-center justify-center transition-colors"><i class="fas fa-check text-[9px]"></i></div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="glass-card rounded-2xl p-5 stagger-4">
            <h2 class="text-base font-bold text-white mb-4 font-kufi text-center">Ø¥ÙÙ†Ù’Ø¬ÙØ§Ø²ÙÙƒÙ ÙÙÙŠ Ø§Ù„Ø®ÙØªÙ’Ù…ÙØ©</h2>
            <div class="relative w-36 h-36 mx-auto mb-4 progress-ring">
                <svg class="w-full h-full -rotate-90">
                    <circle cx="72" cy="72" r="62" stroke="rgba(255,255,255,0.05)" stroke-width="8" fill="none"/>
                    <circle id="khatmaCircle" cx="72" cy="72" r="62" stroke="#f0abfc" stroke-width="8" fill="none" stroke-dasharray="389" stroke-dashoffset="389" stroke-linecap="round"/>
                </svg>
                <div class="absolute inset-0 flex flex-col items-center justify-center">
                    <span id="khatmaPct" class="text-2xl font-bold text-white font-kufi">0%</span>
                    <span id="khatmaLabel" class="text-[10px] text-purple-300 bg-white/10 px-2 py-0.5 rounded-full mt-1 font-kufi">Ø§Ù„Ø®ØªÙ…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰</span>
                </div>
            </div>
            <div class="grid grid-cols-3 gap-2 text-center">
                <div class="bg-white/5 rounded-xl p-2 border border-white/5"><div id="totalPagesDisplay" class="text-lg font-bold text-white font-kufi">0</div><div class="text-[9px] text-purple-400 mt-0.5">ØµÙÙÙ’Ø­ÙØ©</div></div>
                <div class="bg-white/5 rounded-xl p-2 border border-white/5"><div id="taraweehCountDisplay" class="text-lg font-bold text-theme-primary font-kufi">0</div><div class="text-[9px] text-purple-400 mt-0.5">ØªÙØ±ÙØ§ÙˆÙÙŠØ­</div></div>
                <div class="bg-white/5 rounded-xl p-2 border border-white/5"><div id="tahajjudCountDisplay" class="text-lg font-bold text-theme-accent font-kufi">0</div><div class="text-[9px] text-purple-400 mt-0.5">ØªÙÙ‡ÙØ¬ÙÙ‘Ø¯</div></div>
            </div>
        </div>

        <!-- Podcast -->
        <div class="glass-card rounded-2xl p-4 stagger-5">
            <div class="flex items-center gap-2 mb-3">
                <i class="fas fa-pen-fancy text-purple-400 text-sm"></i>
                <h2 class="text-sm font-bold text-purple-300 font-kufi">ÙÙØ§Ø¦ÙØ¯ÙØ©Ù Ø§Ù„ÙŠÙÙˆÙ’Ù…</h2>
            </div>
            <div class="flex gap-2 mb-3">
                <input type="text" id="podcastInput" placeholder="Ø³Ø¬Ù„ÙŠ Ù‡Ù†Ø§ Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø³..." class="flex-1 bg-black/20 border border-white/10 rounded-xl px-3 py-2.5 text-white text-sm focus:outline-none focus:border-theme-accent transition-colors placeholder-white/20">
                <button onclick="window.addPodcast()" class="bg-theme-accent text-theme-bg w-10 rounded-xl flex items-center justify-center font-bold shadow-lg active:scale-95 transition-transform hover:bg-white"><i class="fas fa-plus text-sm"></i></button>
            </div>
            <div id="historyLog" class="space-y-1.5 max-h-36 overflow-y-auto pr-1 custom-scrollbar"></div>
        </div>
        
        <div class="text-center">
            <button onclick="window.resetData()" class="text-[10px] text-red-400/40 px-4 py-2 hover:text-red-400 transition-colors">Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        </div>

        ${FOOTER_HTML}
    </main>

    <!-- Save button -->
    <div class="fixed bottom-0 left-0 w-full p-4 z-50 bg-gradient-to-t from-[#241245] via-[#241245]/80 to-transparent pointer-events-none pb-6">
        <button onclick="window.saveData()" id="saveBtn" class="save-pulse pointer-events-auto w-full max-w-sm mx-auto block bg-gradient-to-r from-theme-accent to-purple-500 text-white font-bold text-sm py-3.5 rounded-2xl shadow-[0_8px_25px_rgba(232,121,249,0.35)] active:scale-[0.98] transition-all flex items-center justify-center gap-2 font-kufi border border-white/10">
            <i class="fas fa-check-circle"></i> Ø­ÙÙÙ’Ø¸Ù Ø¥ÙÙ†Ù’Ø¬ÙØ§Ø²ÙÙƒÙ
        </button>
    </div>
</div>

${DUAA_PAGE}
`;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE & INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser = null;
let currentTheme = 'male';

window.addEventListener('DOMContentLoaded', () => {
    // Check if user is already logged in locally
    const user = localStorage.getItem('ramadanUserName');
    const theme = localStorage.getItem('ramadanUserTheme');

    if (user && theme) {
        currentUser = user;
        currentTheme = theme;
        setupThemeSelected = theme;
        fetchDataAndLoad(user, theme);
    } else {
        const ws = document.getElementById('welcomeScreen');
        ws.style.display = 'flex';
        requestAnimationFrame(() => { ws.style.opacity = '1'; });
    }
});

async function fetchDataAndLoad(user, theme) {
    showLoading(true);
    try {
        if (db) {
            const docRef = doc(db, "users", user);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                const data = docSnap.data();
                if (data.appData) appData = data.appData;
            } else {
                appData = JSON.parse(localStorage.getItem('ramadanTrackerData_v2') || '{}');
            }
        } else {
            appData = JSON.parse(localStorage.getItem('ramadanTrackerData_v2') || '{}');
        }
    } catch(e) {
        console.error("Fetch Data Error:", e);
        appData = JSON.parse(localStorage.getItem('ramadanTrackerData_v2') || '{}');
    } finally {
        loadApp(user, theme);
        showLoading(false);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH & FIREBASE LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showLoading(show) {
    const el = document.getElementById('loadingScreen');
    if(show) { 
        el.classList.remove('hidden'); 
        requestAnimationFrame(()=>el.classList.remove('opacity-0')); 
    } else { 
        el.classList.add('opacity-0'); 
        setTimeout(()=>el.classList.add('hidden'), 300); 
    }
}

window.selectSetupTheme = function(t) {
    setupThemeSelected = t;
    document.querySelectorAll('.theme-option').forEach(el => el.classList.remove('selected', 'selected-f'));
    document.getElementById(t === 'male' ? 'themeMale' : 'themeFemale').classList.add(t === 'male' ? 'selected' : 'selected-f');
};

window.finishSetup = async function() {
    const name = document.getElementById('setupName').value.trim();
    if(!name) { showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…'); return; }
    
    showLoading(true);
    try {
        if (db) {
            const userRef = doc(db, "users", name);
            const userSnap = await getDoc(userRef);

            if (userSnap.exists()) {
                const data = userSnap.data();
                appData = data.appData || {};
            } else {
                appData = {};
                await setDoc(userRef, {
                    username: name,
                    theme: setupThemeSelected,
                    createdAt: new Date().toISOString(),
                    appData: {} 
                });
            }
        }
        
        currentUser = name;
        currentTheme = setupThemeSelected;
        
        localStorage.setItem('ramadanUserName', name);
        localStorage.setItem('ramadanUserTheme', setupThemeSelected);
        
        document.getElementById('welcomeScreen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('welcomeScreen').style.display = 'none';
            loadApp(name, setupThemeSelected);
        }, 400);
    } catch(e) {
        console.error(e);
        showToast('ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø³ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹.');
        currentUser = name;
        currentTheme = setupThemeSelected;
        localStorage.setItem('ramadanUserName', name);
        localStorage.setItem('ramadanUserTheme', setupThemeSelected);
        document.getElementById('welcomeScreen').style.display = 'none';
        loadApp(name, setupThemeSelected);
    } finally {
        showLoading(false);
    }
};

function loadApp(user, theme) {
    const container = document.getElementById('app-container');
    document.body.className = `min-h-screen text-zinc-100 theme-${theme}`;
    container.innerHTML = theme === 'male' ? MALE_TEMPLATE : FEMALE_TEMPLATE;

    const nameEl = document.getElementById(theme === 'male' ? 'userNameDisplayM' : 'userNameDisplayF');
    if (nameEl) nameEl.textContent = user;

    initPrayersUI(theme);
    updateUI();

    requestAnimationFrame(() => {
        container.classList.remove('hidden');
        setTimeout(()=> container.classList.remove('opacity-0'), 10);
    });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SAVE LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.saveData = async function() {
    const theme = currentTheme;
    const user = currentUser;
    if(!user) return;
    
    const prayers = {};
    let fardDone = 0;
    Object.keys(PRAYERS_CONFIG).forEach(k => {
        const fBtn = document.getElementById(`${k}-fard`);
        const sBtn = document.getElementById(`${k}-sunnah`);
        const isFemale = theme === 'female';
        const fActive = isFemale ? fBtn?.classList.contains('btn-active-fard') : fBtn?.classList.contains('active-prayer');
        const sActive = isFemale ? sBtn?.classList.contains('btn-active-sunnah') : sBtn?.classList.contains('active-sunnah');
        prayers[k] = { fard: !!fActive, sunnah: !!sActive };
        if (PRAYERS_CONFIG[k].fard && fActive) fardDone++;
    });

    const isFemale = theme === 'female';
    const isCompleted = (el) => isFemale ? el?.classList.contains('habit-active') : el?.classList.contains('completed-habit');
    
    if(!appData[currentDate]) appData[currentDate] = {};
    const prevPodcasts = appData[currentDate].podcasts || [];

    appData[currentDate] = {
        prayers,
        quran: parseInt(document.getElementById('quranPages')?.value) || 0,
        work: parseFloat(document.getElementById('workHours')?.value) || 0,
        taraweeh: isCompleted(document.getElementById('taraweehCard')),
        azkar: isCompleted(document.getElementById('azkarCard')),
        gym: document.getElementById('gymCard') ? isCompleted(document.getElementById('gymCard')) : false,
        tahajjud: document.getElementById('tahajjudCard') ? isCompleted(document.getElementById('tahajjudCard')) : false,
        podcasts: prevPodcasts
    };

    const btn = document.getElementById('saveBtn');
    const orig = btn.innerHTML;
    const origClass = btn.className;
    
    btn.innerHTML = '<i class="fas fa-spinner fa-spin text-sm"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...';
    btn.classList.remove('save-pulse');
    
    try {
        if (db) {
            await updateDoc(doc(db, "users", user), {
                appData: appData,
                lastUpdated: new Date().toISOString()
            });
        }
        
        localStorage.setItem('ramadanTrackerData_v2', JSON.stringify(appData));
        
        updateDashboard(theme);
        updateWeeklyDots(theme);
        updateStreak(theme);
        
        btn.innerHTML = '<i class="fas fa-check text-sm"></i> ØªÙ…Ù‘ Ø§Ù„Ø­ÙØ¸ âœ“';
        if (fardDone === 5) {
            triggerConfetti(isFemale ? ['#e879f9', '#fcd34d', '#fff'] : ['#fbbf24', '#2dd4bf', '#fff']);
            showToast('Ø£Ø­Ø³Ù†Øª! Ø§ÙƒØªÙ…Ù„Øª ÙØ±Ø§Ø¦Ø¶Ùƒ Ø§Ù„ÙŠÙˆÙ… ğŸŒ™');
        } else {
            showToast('ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­');
        }
    } catch(e) {
        console.error(e);
        showToast('ØªÙ… Ø§Ù„Ø­ÙØ¸ Ù…Ø­Ù„ÙŠØ§Ù‹ (ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª)');
        localStorage.setItem('ramadanTrackerData_v2', JSON.stringify(appData));
        btn.innerHTML = '<i class="fas fa-check text-sm"></i> ØªÙ…Ù‘ Ø§Ù„Ø­ÙØ¸ âœ“';
    }

    setTimeout(() => { 
        btn.innerHTML = orig; 
        btn.className = origClass;
    }, 2000);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARED UI LOGIC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.toggleView = function(view) {
    const dashboard = document.getElementById('dashboard-view');
    const duaa = document.getElementById('duaa-view');
    const navD = document.getElementById('nav-dashboard');
    const navDuaa = document.getElementById('nav-duaa');
    const theme = currentTheme;

    if (view === 'dashboard') {
        dashboard.classList.remove('hidden');
        duaa.classList.add('hidden');
        navD.classList.add('active');
        navD.style.color = theme === 'female' ? '#e9d5ff' : '#e4e4e7';
        navDuaa.classList.remove('active');
    } else {
        dashboard.classList.add('hidden');
        duaa.classList.remove('hidden');
        navD.classList.remove('active');
        navDuaa.classList.add('active');
    }
    window.scrollTo({ top: 0, behavior: 'smooth' });
};

window.changeDate = function(d) {
    const dt = new Date(currentDate);
    dt.setDate(dt.getDate() + d);
    currentDate = dt.toISOString().split('T')[0];
    updateUI();
};

function initPrayersUI(theme) {
    const container = document.getElementById('prayersList');
    if (!container) return;
    container.innerHTML = '';

    Object.keys(PRAYERS_CONFIG).forEach(key => {
        const p = PRAYERS_CONFIG[key];
        const isFemale = theme === 'female';
        const rowClass = isFemale
            ? "flex justify-between items-center py-2.5 border-b border-white/5 last:border-0"
            : "flex justify-between items-center py-2.5 border-b border-zinc-900 last:border-0 px-1 rounded-lg";
        const labelClass = isFemale
            ? `font-medium text-sm text-white font-kufi ${key === 'duha' ? 'text-theme-accent' : ''}`
            : `font-medium text-sm text-zinc-300 ${key === 'duha' ? 'text-zinc-200' : ''}`;
        const btnBase = isFemale
            ? "prayer-btn h-8 px-3 rounded-lg border text-[11px] transition-all font-medium border-white/10 text-purple-200 bg-transparent"
            : "prayer-btn px-3 py-1.5 rounded-lg border text-xs font-medium transition-all border-zinc-800 text-zinc-600 bg-transparent hover:border-zinc-600 hover:text-zinc-300";

        let btns = '<div class="flex gap-1.5">';
        if (p.fard) btns += `<button id="${key}-fard" onclick="window.togglePrayer(this,'${key}','fard','${theme}')" class="${btnBase}">ÙÙØ±Ù’Ø¶</button>`;
        else btns += `<span class="text-[10px] opacity-50 self-center text-current px-1">Ø³ÙÙ†ÙÙ‘Ø©</span>`;
        if (p.sunnah) btns += `<button id="${key}-sunnah" onclick="window.togglePrayer(this,'${key}','sunnah','${theme}')" class="${btnBase}">Ø³ÙÙ†ÙÙ‘Ø©</button>`;
        btns += '</div>';

        container.innerHTML += `<div class="${rowClass}"><span class="${labelClass}">${p.label}</span>${btns}</div>`;
    });
}

window.togglePrayer = function(btn, key, type, theme) {
    const isFemale = theme === 'female';
    const activeClass = isFemale ? (type === 'fard' ? 'btn-active-fard' : 'btn-active-sunnah') : (type === 'fard' ? 'active-prayer' : 'active-sunnah');
    const isActive = btn.classList.contains(activeClass);
    applyBtnStyle(btn, !isActive, type, theme);
};

function applyBtnStyle(btn, active, type, theme) {
    if (!btn) return;
    const isFemale = theme === 'female';
    const activeClass = isFemale ? (type === 'fard' ? 'btn-active-fard' : 'btn-active-sunnah') : (type === 'fard' ? 'active-prayer' : 'active-sunnah');
    if (active) btn.classList.add(activeClass);
    else btn.classList.remove(activeClass);
}

window.toggleHabit = function(id) {
    const card = document.getElementById(id + 'Card');
    const theme = currentTheme;
    if (theme === 'female') {
        card.classList.toggle('habit-active');
    } else {
        const done = !card.classList.contains('completed-habit');
        updateHabitVisual(id, done, theme);
    }
};

function updateHabitVisual(id, completed, theme) {
    const card = document.getElementById(id + 'Card');
    if (!card) return;

    if (theme === 'female') {
        if (completed) card.classList.add('habit-active');
        else card.classList.remove('habit-active');
    } else {
        const icon = card.querySelector('.rounded-full');
        const check = card.querySelector('.check-circle');
        const checkI = check?.querySelector('i');
        const text = card.querySelector('span');

        if (completed) {
            card.classList.add('completed-habit', 'bg-zinc-800/80', 'border-zinc-600');
            card.classList.remove('bg-zinc-900/20', 'border-zinc-800/60');
            icon?.classList.replace('bg-zinc-800', 'bg-white'); icon?.classList.replace('text-zinc-500', 'text-black');
            text?.classList.replace('text-zinc-400', 'text-white');
            check?.classList.add('bg-white', 'border-white'); check?.classList.remove('border-zinc-700');
            if (checkI) checkI.style.color = '#000';
        } else {
            card.classList.remove('completed-habit', 'bg-zinc-800/80', 'border-zinc-600');
            card.classList.add('bg-zinc-900/20', 'border-zinc-800/60');
            icon?.classList.replace('bg-white', 'bg-zinc-800'); icon?.classList.replace('text-black', 'text-zinc-500');
            text?.classList.replace('text-white', 'text-zinc-400');
            check?.classList.remove('bg-white', 'border-white'); check?.classList.add('border-zinc-700');
            if (checkI) checkI.style.color = 'transparent';
        }
    }
}

function updateUI() {
    const dt = new Date(currentDate);
    const dateStr = dt.toLocaleDateString('ar-EG', { weekday: 'short', day: 'numeric', month: 'numeric' });
    document.getElementById('currentDateDisplay').textContent = dateStr;

    const day = appData[currentDate] || {};
    const theme = currentTheme;
    const prayers = day.prayers || {};

    Object.keys(PRAYERS_CONFIG).forEach(k => {
        const s = prayers[k] || {};
        const p = PRAYERS_CONFIG[k];
        if (p.fard) applyBtnStyle(document.getElementById(`${k}-fard`), s.fard, 'fard', theme);
        if (p.sunnah) applyBtnStyle(document.getElementById(`${k}-sunnah`), s.sunnah, 'sunnah', theme);
    });

    ['taraweeh', 'azkar'].forEach(h => updateHabitVisual(h, day[h], theme));
    if (theme === 'male') updateHabitVisual('gym', day.gym, theme);
    if (theme === 'female') updateHabitVisual('tahajjud', day.tahajjud, theme);

    const qEl = document.getElementById('quranPages');
    const wEl = document.getElementById('workHours');
    if (qEl) qEl.value = day.quran || '';
    if (wEl) wEl.value = day.work || '';

    updateDashboard(theme);
    updateWeeklyDots(theme);
    updateStreak(theme);
}

function updateWeeklyDots(theme) {
    const container = document.getElementById('weeklyDots');
    if (!container) return;

    const isFemale = theme === 'female';
    const dayNames = ['Ø­', 'Ù†', 'Ø«', 'Ø±', 'Ø®', 'Ø¬', 'Ø³'];
    let html = '';

    for (let i = 6; i >= 0; i--) {
        const d = new Date();
        d.setDate(d.getDate() - i);
        const key = d.toISOString().split('T')[0];
        const dayData = appData[key];
        const dayName = dayNames[d.getDay()];

        let cls = 'empty';
        if (dayData) {
            const prayers = dayData.prayers || {};
            const fardTotal = Object.keys(PRAYERS_CONFIG).filter(k => PRAYERS_CONFIG[k].fard).length;
            const fardDone = Object.keys(PRAYERS_CONFIG).filter(k => PRAYERS_CONFIG[k].fard && prayers[k]?.fard).length;
            if (fardDone === fardTotal) cls = isFemale ? 'done-full female' : 'done-full';
            else if (fardDone > 0) cls = isFemale ? 'done-partial female' : 'done-partial';
        }

        html += `<div class="flex flex-col items-center gap-1">
            <div class="week-dot ${cls}" title="${key}"></div>
            <span class="text-[8px] opacity-30 font-eng">${dayName}</span>
        </div>`;
    }
    container.innerHTML = html;
}

function updateStreak(theme) {
    let streak = 0;
    const d = new Date();

    for (let i = 0; i < 30; i++) {
        const key = d.toISOString().split('T')[0];
        const dayData = appData[key];
        if (!dayData || !dayData.prayers) break;

        const fardKeys = Object.keys(PRAYERS_CONFIG).filter(k => PRAYERS_CONFIG[k].fard);
        const allDone = fardKeys.every(k => dayData.prayers[k]?.fard);
        if (allDone) streak++;
        else if (i > 0) break;

        d.setDate(d.getDate() - 1);
    }

    const badge = document.getElementById(theme === 'male' ? 'streakBadgeM' : 'streakBadgeF');
    const count = document.getElementById(theme === 'male' ? 'streakCountM' : 'streakCountF');
    if (badge && count) {
        if (streak >= 2) {
            badge.classList.remove('hidden');
            badge.classList.add('flex');
            count.textContent = streak;
        } else {
            badge.classList.add('hidden');
            badge.classList.remove('flex');
        }
    }
}

window.addPodcast = function() {
    const inp = document.getElementById('podcastInput');
    const val = inp.value.trim();
    if (!val) return;
    if (!appData[currentDate]) appData[currentDate] = {};
    if (!appData[currentDate].podcasts) appData[currentDate].podcasts = [];
    appData[currentDate].podcasts.push(val);
    inp.value = '';
    window.saveData(); 
    showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ§Ø¦Ø¯Ø©');
}

function updateDashboard(theme) {
    let totalQ = 0, totalT = 0, totalG = 0, totalTh = 0;
    let fTotal = 0, fCount = 0, sTotal = 0, sCount = 0;

    Object.values(appData).forEach(d => {
        totalQ += (d.quran || 0);
        if (d.taraweeh) totalT++;
        if (d.gym) totalG++;
        if (d.tahajjud) totalTh++;
        if (d.prayers) {
            Object.keys(PRAYERS_CONFIG).forEach(k => {
                const c = PRAYERS_CONFIG[k];
                const s = d.prayers[k] || {};
                if (c.fard) { fTotal++; if (s.fard) fCount++; }
                if (c.sunnah) { sTotal++; if (s.sunnah) sCount++; }
            });
        }
    });

    const KHATMA = 604;
    let khatmaNum = Math.floor(totalQ / KHATMA) + 1;
    let currentQ = totalQ % KHATMA;
    if (totalQ > 0 && currentQ === 0) { khatmaNum--; currentQ = KHATMA; }
    if (totalQ === 0) khatmaNum = 1;

    const pct = (currentQ / KHATMA) * 100;
    const circle = document.getElementById('khatmaCircle');
    if (circle) {
        const C = theme === 'female' ? 389 : 283;
        const offset = C - (C * pct) / 100;
        circle.style.strokeDashoffset = offset;
    }

    const set = (id, v) => { const el = document.getElementById(id); if (el) el.textContent = v; };
    set('khatmaPct', Math.round(pct) + '%');
    set('khatmaLabel', 'Ø§Ù„Ø®ØªÙ…Ø© ' + khatmaNum);
    set('totalPagesDisplay', totalQ);
    if (document.getElementById('pagesLeftBadge')) set('pagesLeftBadge', Math.max(0, KHATMA - currentQ));

    if (theme === 'male') {
        set('taraweehCountDisplay', totalT);
        set('gymCountDisplay', totalG);
        set('prayerStat', fTotal ? Math.round((fCount / fTotal) * 100) + '%' : '0%');
        set('sunnahStat', sTotal ? Math.round((sCount / sTotal) * 100) + '%' : '0%');
    } else {
        set('taraweehCountDisplay', totalT);
        set('tahajjudCountDisplay', totalTh);
    }

    const log = document.getElementById('historyLog');
    if (!log) return;
    let html = '';
    Object.keys(appData).sort().reverse().forEach(date => {
        const pods = appData[date]?.podcasts || [];
        if (pods.length) {
            const dStr = new Date(date).toLocaleDateString('ar-EG', { day: 'numeric', month: 'numeric' });
            pods.forEach(p => {
                if (theme === 'female') {
                    html += `<div class="flex justify-between items-center p-2 bg-white/5 rounded-lg border border-white/5 gap-2">
                        <span class="text-xs text-purple-100 truncate">${p}</span>
                        <span class="text-[10px] text-theme-accent bg-theme-accent/10 px-1.5 py-0.5 rounded shrink-0">${dStr}</span>
                    </div>`;
                } else {
                    html += `<div class="flex justify-between items-center p-2 bg-zinc-900/80 rounded-lg border border-zinc-800 gap-2 hover:border-zinc-700 transition-colors">
                        <span class="text-xs text-zinc-300 truncate">${p}</span>
                        <span class="text-[10px] text-zinc-400 bg-zinc-800 px-2 py-0.5 rounded shrink-0 border border-zinc-700">${dStr}</span>
                    </div>`;
                }
            });
        }
    });
    log.innerHTML = html || `<div class="text-center text-xs opacity-30 py-3 font-kufi">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø¨Ø¹Ø¯</div>`;
}

window.resetData = function() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
        ['ramadanTrackerData', 'ramadanTrackerData_v2', 'ramadanUserName', 'ramadanUserTheme'].forEach(k => localStorage.removeItem(k));
        location.reload();
    }
}

let toastTimer;
function showToast(msg) {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => t.classList.remove('show'), 2400);
}
</script>
</body>
</html>
